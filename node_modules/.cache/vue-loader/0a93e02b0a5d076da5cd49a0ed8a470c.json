{"remainingRequest":"D:\\a-my-html\\html-GIS\\git-develop\\vue-industry-gis\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\a-my-html\\html-GIS\\git-develop\\vue-industry-gis\\src\\views\\HeritageRepairLocalMap.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"D:\\a-my-html\\html-GIS\\git-develop\\vue-industry-gis\\src\\views\\HeritageRepairLocalMap.vue","mtime":1649946115061},{"path":"D:\\a-my-html\\html-GIS\\git-develop\\vue-industry-gis\\node_modules\\css-loader\\dist\\cjs.js","mtime":1637922544066},{"path":"D:\\a-my-html\\html-GIS\\git-develop\\vue-industry-gis\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1637922548447},{"path":"D:\\a-my-html\\html-GIS\\git-develop\\vue-industry-gis\\node_modules\\postcss-loader\\src\\index.js","mtime":1637922545893},{"path":"D:\\a-my-html\\html-GIS\\git-develop\\vue-industry-gis\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1637922542348},{"path":"D:\\a-my-html\\html-GIS\\git-develop\\vue-industry-gis\\node_modules\\vue-loader\\lib\\index.js","mtime":1637922546721}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi5oZXJpdGFnZS1Ib3QtTWFwIC5kZW1vLXRpdGxlIHsNCiAgcG9zaXRpb246IHJlbGF0aXZlOw0KICB0b3A6IDEwcHg7DQogIHotaW5kZXg6IDk7DQogIGxlZnQ6IDE1cHg7DQp9DQouaGVyaXRhZ2UtSG90LU1hcCAuZGVtby10aXRsZSBoMSB7DQogIG1hcmdpbjogMDsNCiAgY29sb3I6ICNhY2IzYmI7DQp9DQoNCi5oZXJpdGFnZS1Ib3QtTWFwIC5kZW1vLXRpdGxlIGgzIHsNCiAgZm9udC13ZWlnaHQ6IG5vcm1hbDsNCiAgbWFyZ2luLXRvcDogNXB4Ow0KICBjb2xvcjogIzhlOTM5ZDsNCn0NCg0KLyogLmhlcml0YWdlLUhvdC1NYXAgLmxlZ2VuZCB7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgYm90dG9tOiAyMHB4Ow0KICByaWdodDogMjBweDsNCn0NCg0KLmhlcml0YWdlLUhvdC1NYXAgLmxlZ2VuZCB1bCB7DQogIHBhZGRpbmc6IDA7DQogIG1hcmdpbjogMDsNCiAgbGlzdC1zdHlsZTogbm9uZTsNCn0NCg0KLmhlcml0YWdlLUhvdC1NYXAgLmNvbG9yLWl0ZW0gew0KICB3aWR0aDogMzBweDsNCiAgaGVpZ2h0OiAyMHB4Ow0KICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQp9DQoNCi5oZXJpdGFnZS1Ib3QtTWFwIC5sYWJlbC1pdGVtIHsNCiAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICB3aWR0aDogMzBweDsNCiAgbWFyZ2luLWxlZnQ6IC0ycHg7DQogIGZvbnQtc2l6ZTogMTRweDsNCn0gKi8NCi5oZXJpdGFnZS1Ib3QtTWFwIC5pbmZvIHsNCiAgcGFkZGluZzogMC43NXJlbSAxLjI1cmVtOw0KICBtYXJnaW4tYm90dG9tOiAxcmVtOw0KICBib3JkZXItcmFkaXVzOiAwLjI1cmVtOw0KICBwb3NpdGlvbjogZml4ZWQ7DQogIHRvcDogMXJlbTsNCiAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7DQogIHdpZHRoOiBhdXRvOw0KICBtaW4td2lkdGg6IDIycmVtOw0KICBib3JkZXItd2lkdGg6IDA7DQogIHJpZ2h0OiAxcmVtOw0KICBib3gtc2hhZG93OiAwIDJweCA2cHggMCByZ2JhKDExNCwgMTI0LCAyNDUsIDAuNSk7DQogIGZvbnQtc2l6ZTogMTJweDsNCn0NCi5oZXJpdGFnZS1Ib3QtTWFwIC5pbmZvIHNwYW4gew0KICBjb2xvcjogIzFiOTFmZjsNCn0NCg=="},{"version":3,"sources":["HeritageRepairLocalMap.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"HeritageRepairLocalMap.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n  <!-- 遗产维修状况柱状图 -->\r\n  <div class=\"heritage-Hot-Map\">\r\n    <div class=\"heritage-industry\">\r\n      <!-- 地图容器 -->\r\n      <div id=\"container\" class=\"container\">\r\n        <div class=\"demo-title\">\r\n          <h3>所有工业遗产累计维修次数多面棱柱图</h3>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n  <script type=\"text/javascript\"\r\n    src=\"https://webapi.amap.com/maps?v=1.4.15&key=2eccb47b400c8ab58f2dc596dbfe9d53&plugin=AMap.MouseTool,AMap.Driving,AMap.DistrictSearch,AMap.Geocoder,Map3D\"></script>\r\n  <script src=\"https://webapi.amap.com/loca?v=1.3.2&key=2eccb47b400c8ab58f2dc596dbfe9d53\"></script>\r\n    \r\n<script>\r\nimport { mapState } from \"vuex\";\r\nexport default {\r\n  components: {},\r\n\r\n  data() {\r\n    return {\r\n      map: \"\",\r\n      district: null,\r\n      polygons: [],\r\n      layer: null, //棱柱图层\r\n      angle: 90,\r\n      // pl: null, //棱柱图层\r\n      // geo: null, //数据源\r\n      // clickInfo: null,\r\n      // dat: null,\r\n      // 地图变量\r\n      infoWin: null,\r\n      tableDom: null,\r\n      list: [],\r\n    };\r\n  },\r\n\r\n  created() {\r\n    // console.log(\"list\", this.list);\r\n    // console.log(this.dataList);\r\n  },\r\n\r\n  mounted() {\r\n    this.initMap(); //初始化地图\r\n    this.drawBounds();\r\n    this.drawLocal(); //创建棱柱图\r\n    this.changeLightDirection();\r\n  },\r\n\r\n  computed: {\r\n    ...mapState([\"lang\"]),\r\n  },\r\n\r\n  methods: {\r\n    initMap() {\r\n      //初始化地图\r\n      this.map = new AMap.Map(\"container\", {\r\n        resizeEnable: true,\r\n        zoom: 9, //级别\r\n        zooms: [6.5, 18],\r\n        center: [115.464523, 38.874476], //中心点坐标\r\n        viewMode: \"3D\", //使用3D视图\r\n        lang: this.lang,\r\n        mapStyle: \"amap://styles/db9efe6a1745ac24b7269b862f359536\",\r\n        infoWindow: null,\r\n        pitch: 46,\r\n      });\r\n    },\r\n\r\n    // 裁剪边界\r\n    drawBounds() {\r\n      if (!this.district) {\r\n        //实例化DistrictSearch\r\n        var opts = {\r\n          subdistrict: 0, //获取边界不需要返回下级行政区\r\n          extensions: \"all\", //返回行政区边界坐标组等具体信息\r\n          level: \"province\", //查询行政级别为 市\r\n        };\r\n        this.district = new AMap.DistrictSearch(opts);\r\n      }\r\n      this.district.setLevel(\"province\");\r\n      var _this = this;\r\n      this.district.search(\"河北省\", function (status, result) {\r\n        // 河北省边界\r\n        // var bounds = result.districtList[0].boundaries;\r\n        // console.log(result);\r\n        // console.log(status);\r\n\r\n        var outer = [\r\n          new AMap.LngLat(-360, 90, true),\r\n          new AMap.LngLat(-360, -90, true),\r\n          new AMap.LngLat(360, -90, true),\r\n          new AMap.LngLat(360, 90, true),\r\n        ];\r\n        var holes = result.districtList[0].boundaries;\r\n\r\n        var pathArray = [outer];\r\n        pathArray.push.apply(pathArray, holes);\r\n        var polygon = new AMap.Polygon({\r\n          pathL: pathArray,\r\n          strokeColor: \"#F9D5A7\",\r\n          strokeWeight: 1,\r\n          fillColor: \"#F9D5A7\",\r\n          fillOpacity: 0.2,\r\n        });\r\n        polygon.setPath(pathArray);\r\n        _this.map.add(polygon);\r\n      });\r\n    },\r\n\r\n    async drawLocal() {\r\n      this.$message({\r\n        message: \"工业遗产累计维修次数棱柱图绘制中，初次加载可能用时较长\",\r\n      });\r\n\r\n      // 获取数据start\r\n      var res;\r\n      res = await this.$axios.get(\"/getApplyRepairData/getApplyRepairData\");\r\n      console.log(res);\r\n      res.data.data.forEach((ele) => {\r\n        // console.log(ele);\r\n        var index = this.list.findIndex((che) => che.name === ele.name);\r\n        // console.log(index);\r\n        if (index !== -1) {\r\n          this.list[index].num = this.list[index].num + 1;\r\n          this.list[index].num1 = this.list[index].num * 100;\r\n        } else {\r\n          this.list = [\r\n            ...this.list,\r\n            {\r\n              ...ele,\r\n              num: 1,\r\n              num1: 10,\r\n              coordinateStr: ele.jing + `,` + ele.wei,\r\n            },\r\n          ];\r\n        }\r\n      });\r\n      console.log(\"格式化数据\", this.list);\r\n      // 获取数据end\r\n\r\n      this.layer = new Loca.ScatterPointLayer({\r\n        map: this.map,\r\n        eventSupport: true,\r\n      });\r\n\r\n      this.layer.setData(this.list.slice(0, 5000), {\r\n        lnglat: \"coordinateStr\",\r\n      });\r\n\r\n      var colors = [\"#0553A1\", \"#0B79B0\", \"#10B3B0\", \"#7CCF98\", \"#DCE872\"];\r\n\r\n      this.layer.setOptions({\r\n        // 设定棱柱体顶点数量, 默认 16，呈现圆柱体\r\n        //vertex: 4,\r\n        // 单位米\r\n        unit: \"meter\",\r\n        light: {\r\n          // 环境光\r\n          ambient: {\r\n            // 光照颜色\r\n            color: \"#ffffff\",\r\n            // 光照强度，范围 [0, 1]\r\n            intensity: 0.5,\r\n          },\r\n          // 平行光\r\n          directional: {\r\n            color: \"#ffffff\",\r\n            // 光照方向，是指从地面原点起，光指向的方向。\r\n            // 数组分别表示 X 轴、Y 轴、Z 轴。\r\n            // 其中 X 正向朝东、Y 正向朝南、Z 正向朝地下。\r\n            direction: [1, -1.5, 2],\r\n            intensity: 0.6,\r\n          },\r\n        },\r\n        style: {\r\n          // 正多边形半径\r\n          radius: 3500,\r\n          height: {\r\n            key: \"num1\",\r\n            value: [0, 50000],\r\n          },\r\n          // 顶边颜色\r\n          color: {\r\n            key: \"num\",\r\n            scale: \"quantile\",\r\n            value: colors,\r\n          },\r\n          opacity: 0.9,\r\n          // 旋转角度，单位弧度\r\n          rotate: (Math.PI / 180) * 45,\r\n        },\r\n        selectStyle: {\r\n          color: \"#fcff19\",\r\n          opacity: 0.9,\r\n        },\r\n      });\r\n\r\n      this.layer.on(\"mousemove\", (ev) => {\r\n        this.openInfoWin(this.map, ev.originalEvent, {\r\n          遗产名称: ev.rawData.name,\r\n          维修次数: ev.rawData.num,\r\n          遗产类型: ev.rawData.addType,\r\n          遗产地址: ev.rawData.address,\r\n\r\n          坐标: ev.rawData.coordinateStr,\r\n        });\r\n      });\r\n      this.layer.render();\r\n      this.map.DirectionLight = new AMap.Lights.DirectionLight(\r\n        [0, -1, 2],\r\n        [1, 1, 1],\r\n        0.7\r\n      );\r\n    },\r\n\r\n    openInfoWin(map, event, content) {\r\n      // 鼠标移入弹出圆柱信息\r\n      if (!this.infoWin) {\r\n        this.infoWin = new AMap.InfoWindow({\r\n          autoMove: false,\r\n          isCustom: true, //使用自定义窗体\r\n          offset: new AMap.Pixel(130, 100),\r\n        });\r\n      }\r\n\r\n      var x = event.offsetX;\r\n      var y = event.offsetY;\r\n      var lngLat = this.map.containerToLngLat(new AMap.Pixel(x, y));\r\n\r\n      if (!this.tableDom) {\r\n        let infoDom = document.createElement(\"div\");\r\n        infoDom.className = \"info\";\r\n        this.tableDom = document.createElement(\"table\");\r\n        infoDom.appendChild(this.tableDom);\r\n        this.infoWin.setContent(infoDom);\r\n      }\r\n\r\n      var trStr = \"\";\r\n      for (var name in content) {\r\n        var val = content[name];\r\n        trStr +=\r\n          \"<tr>\" +\r\n          '<td class=\"label\">' +\r\n          name +\r\n          \"</td>\" +\r\n          \"<td>&nbsp;</td>\" +\r\n          '<td class=\"content\">' +\r\n          val +\r\n          \"</td>\" +\r\n          \"</tr>\";\r\n      }\r\n\r\n      this.tableDom.innerHTML = trStr;\r\n      this.infoWin.open(this.map, lngLat);\r\n    },\r\n\r\n    closeInfoWin() {\r\n      if (this.infoWin) {\r\n        this.infoWin.close();\r\n      }\r\n    },\r\n    changeLightDirection() {\r\n      // 改变光影\r\n      this.angle += 2;\r\n      var dir = [\r\n        Math.cos((this.angle / 180) * Math.PI),\r\n        -Math.sin((this.angle / 180) * Math.PI),\r\n        2,\r\n      ];\r\n      this.map.DirectionLight.setDirection(dir);\r\n      this.map.render();\r\n      AMap.Util.requestAnimFrame(this.changeLightDirection);\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.heritage-Hot-Map .demo-title {\r\n  position: relative;\r\n  top: 10px;\r\n  z-index: 9;\r\n  left: 15px;\r\n}\r\n.heritage-Hot-Map .demo-title h1 {\r\n  margin: 0;\r\n  color: #acb3bb;\r\n}\r\n\r\n.heritage-Hot-Map .demo-title h3 {\r\n  font-weight: normal;\r\n  margin-top: 5px;\r\n  color: #8e939d;\r\n}\r\n\r\n/* .heritage-Hot-Map .legend {\r\n  position: absolute;\r\n  bottom: 20px;\r\n  right: 20px;\r\n}\r\n\r\n.heritage-Hot-Map .legend ul {\r\n  padding: 0;\r\n  margin: 0;\r\n  list-style: none;\r\n}\r\n\r\n.heritage-Hot-Map .color-item {\r\n  width: 30px;\r\n  height: 20px;\r\n  display: inline-block;\r\n}\r\n\r\n.heritage-Hot-Map .label-item {\r\n  display: inline-block;\r\n  width: 30px;\r\n  margin-left: -2px;\r\n  font-size: 14px;\r\n} */\r\n.heritage-Hot-Map .info {\r\n  padding: 0.75rem 1.25rem;\r\n  margin-bottom: 1rem;\r\n  border-radius: 0.25rem;\r\n  position: fixed;\r\n  top: 1rem;\r\n  background-color: white;\r\n  width: auto;\r\n  min-width: 22rem;\r\n  border-width: 0;\r\n  right: 1rem;\r\n  box-shadow: 0 2px 6px 0 rgba(114, 124, 245, 0.5);\r\n  font-size: 12px;\r\n}\r\n.heritage-Hot-Map .info span {\r\n  color: #1b91ff;\r\n}\r\n</style>"]}]}